<!DOCTYPE html>
<html>
<!-- replace all 'row'->'wor' & 'col'->'loc' to avoid classes conflict with bootstrap -->
<head>
<link title="Search Range" rel="icon" type="image/gif/png"
	href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRLplBpU6vn5cBgK8V_mMq476YQXMBdsFIzK83txzcL0JwXDmPd">
<title>Home</title>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/index.js"></script>
<script src="js/register.js"></script>
<script src="js/login.js"></script>
 <script src="js/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.js"></script> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.css">
<link rel="stylesheet" type="text/css" href="./css/index.css">
<link rel="stylesheet" type="text/css" href="./css/Bootstrap.min.css">


<link rel="stylesheet" type="text/css" href="./css/cr.css">
<link rel="stylesheet" type="text/css" href="./css/jquery-ui.css">

<link rel="stylesheet" href="assets/css/main.css">
<link rel="stylesheet" href="assets/css/blue.css">
<link rel="stylesheet" href="assets/css/owl.carousel.css">
<link rel="stylesheet" href="assets/css/owl.transitions.css">
<link rel="stylesheet" href="assets/css/animate.min.css">
<link rel="stylesheet" href="assets/css/rateit.css">
<link rel="stylesheet" href="assets/css/bootstrap-select.min.css">


<!-- Fonts -->
<link
	href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,700'
	rel='stylesheet' type='text/css'>
<link
	href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,600italic,700,700italic,800'
	rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700'
	rel='stylesheet' type='text/css'>

<!-- Customizable CSS -->
<link rel="stylesheet" href="./bootstrapFiles/css/rateit.css">

<!-- Icons/Glyphs -->
<link rel="stylesheet" href="./bootstrapFiles/css/font-awesome.css">
<link rel="stylesheet" href="./bootstrapFiles/fontawesome-all.css">
<script src="js/bootstrap.min.js"></script>

<style>
body {
	font-family: Arial, Helvetica, sans-serif;
	background-color: black;
}

* {
	box-sizing: border-box;
}

/* Add padding to containers */
.container {
	padding: 16px;
	background-color: white;
}
/* Full-width input fields */

/* Overwrite default styles of hr */
hr {
	border: 1px solid #f1f1f1;
	margin-bottom: 25px;
}

/* Set a style for the submit button */

/* Add a blue text color to links */
a {
	color: dodgerblue;
}

/* Set a grey background color and center the text of the "sign in" section */
.signin {
	background-color: #f1f1f1;
	text-align: center;
}

.round3 {
	width: 100%;
	border: 1px solid Black;
	border-radius: 10px;
}

.img {
	border-radius: 50%;
	border: 1px solid Black;
}

::placeholder {
	color: black;
	opacity: 50; /* Firefox */
}

:-ms-input-placeholder { /* Internet Explorer 10-11 */
	color: black;
}

::-ms-input-placeholder { /* Microsoft Edge */
	color: black;
}

#carosel {
	width: 100%;
	max-height: 500px;
}

.carousel-inner {
	width: 100%;
	max-height: 500px !important;
}

.carousel-inner  .item  img {
	width: 100%;
	height: 200px;
}

.container {
	width: 100%;
}
</style>
</head>
<body>
	<header class="CGBNf7">
		<div class="_1tz-RS">
			<div class="AsXM8z">
				<div class="_2OJxl5">
					<a href="index.html"><img width="180"
						src="img/cooltext319580814447697.png" alt="Booklender"
						title="Booklender" class="jnSYHL"></a>
				</div>
				<div class="_1NLCcM">
					<form class="_1WMLwI header-form-search" action="#" method="GET">
<div class="wor">
							<div class="loc-11-12 ">
								<div class="O8ZS_U">
									<input type="text" value="" class="LM6RPg"
										autocomplete="off"
										placeholder="Search for books" id="search-bar">
								</div>
							</div>
							<div class="loc-1-12">
								<a class="vh79eN" type="submit" id="search-button">
									<svg width="20" height="20" viewBox="0 0 17 18" class=""
										xmlns="http://www.w3.org/2000/svg">
										<g fill="#2874F1" fill-rule="evenodd">
											<path class="_2BhAHa"
											d="m11.618 9.897l4.225 4.212c.092.092.101.232.02.313l-1.465 1.46c-.081.081-.221.072-.314-.02l-4.216-4.203"></path>
											<path class="_2BhAHa"
											d="m6.486 10.901c-2.42 0-4.381-1.956-4.381-4.368 0-2.413 1.961-4.369 4.381-4.369 2.42 0 4.381 1.956 4.381 4.369 0 2.413-1.961 4.368-4.381 4.368m0-10.835c-3.582 0-6.486 2.895-6.486 6.467 0 3.572 2.904 6.467 6.486 6.467 3.582 0 6.486-2.895 6.486-6.467 0-3.572-2.904-6.467-6.486-6.467"></path>
										</g>
									</svg>
								</a>
								
							</div>
							<input type="hidden" name="item.html?bookId=" value="search"> 
						</div>
							<input type="hidden" name="otracker" value="search"> <input
								type="hidden" name="otracker1" value="search"> <input
								type="hidden" name="marketplace" value="FLIPKART"> <input
								type="hidden" name="as-show" value="off"> <input
								type="hidden" name="as" value="off">
						</div>
					</form>
				</div>

				<div class="_1Wr4v5">
					<div class="JvUE0p">
						<!-- added class 'logInb1' here -->
						<div class="_2f5Jjv logInb1 username" data-toggle="modal"
							data-target="#modal">Login &amp; Register</div>
					</div>

				</div>
				<div class="_1Wr4v5">
					<div class="JvUE0p">
						<!-- added class 'logInb1' here -->
						<div class="_2f5Jjv">
							<a href="index.html">More</a>
						</div>
					</div>

				</div>
			</div>
		</div>
	</header>

	<!-- Body -->
	<!-- model for login page -->
	<!-- added modal here -->
	<div class="modal fade" id="modal" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<!-- set width and height here -->
			<div class="modal-content" style="padding: 0">
				<div class="modal-body" style="padding: 0">
					<div id="loginModal" class="uMF2cc" style="display: none;">
						<div class="_1XBjg- wor _3Nz-h3">
							<div class="Og_iib loc loc-2-5 _2Bol6j">
								<span class="_1hgiYz"><span>Login</span></span>
								<p class="_1NJjZd">
									<span>Request and Lend the Book which is No usefull to
										you Now</span>
								</p>
							</div>
							<div class="Km0IJL loc loc-3-5">
								<div>
									<form id="loginForm" autocomplete="off">
										<div class="_39M2dM">
											<input type="text" name="user_email" autocomplete="off"
												autofocus="" class="_2zrpKA" value=""
												placeholder="Enter Email Id"> <span class="s-YM1W"></span>
											<!--<label class="b5konl"><span>Enter Email/Mobile number</span></label>-->
											<!--label-->
											<span class="ZAtlA-" id="amit2"></span>
											<!--warning incorrect login-->
										</div>

										<!--					<span class="ZAtlA-"><span>Your username or password is incorrect</span></span> -->

										<div class="_39M2dM">
											<input type="password" name="password" autocomplete="off"
												class="_2zrpKA _3v41xv" value=""
												placeholder="Enter Password"> <span class="s-YM1W"></span>
											<!--	<label class="b5konl"><span>Enter Password</span></label>-->
											<a class="_21JmK0 _1__46T" tabindex="-1"><span>Forgot?</span></a>
										</div>

										<div class="_1avdGP">
											<button id="loginButton" class="_2AkmmA _1LctnI _7UHT_c">
												<div class="_2VTdOs _1_qmw3">
													<svg class="_2zN0mv" viewBox="25 25 50 50">
														<circle stroke="#fff" class="_1VgS7d" cx="50" cy="50"
															r="20" fill="none" stroke-width="5"
															stroke-miterlimit="10"></circle>
													</svg>
												</div>
												<span>Login</span>
												<!-- changed id 'signUpb1' to class -->
											</button>
										</div>
										<a class="_2AkmmA _1LctnI jUwFiZ signUpb1"><span>New
												to Booklender? Register</span></a>
										<div class="_2Q8OlA">
											<div class="S5kkau">
												<span>We no longer support login via Social accounts.
													To recover your old accounts please </span>
												<div class="_20yN1P">
													<span class="_2ykT1U">click here</span>
												</div>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>

					<!--first signup page that appears on clicking " new to flipkart? sign up "-->
					<div id="signUpModal1" class="_32LSmx" style="display: none;">
						<div class=" _1XBjg- wor">
							<div class="Og_iib loc loc-2-5">
								<span class="_1hgiYz"><span>Register</span></span>
								<p class="_1NJjZd">
									<span>We do not share your personal details with anyone.</span>
								</p>
							</div>
							<div class="Km0IJL loc loc-3-5">
								<div>
									<form>
										<!-- added id 'mob1' here -->
										<div class="_39M2dM">
											<input type="user_email" maxlength="100" autocomplete="off"
												class="_2zrpKA" value="" id="email1"
												placeholder="Enter Email Id"> <span class="s-YM1W"></span><label
												class="b5konl"> <!--<span>Enter Mobile number</span>-->
											</label> <span class="ZAtlA-" id="amit3"></span>

										</div>
									</form>
									<!-- added id 'continue' here -->
									<div class="_1avdGP">
										<button class="_2AkmmA _1LctnI _7UHT_c" id="continue">
											<div class="_2VTdOs _1_qmw3">
												<svg class="_2zN0mv" viewBox="25 25 50 50">
													<circle stroke="#fff" class="_1VgS7d" cx="50" cy="50"
														r="20" fill="none" stroke-width="5" stroke-miterlimit="10"></circle>
												</svg>
											</div>
											<span>CONTINUE</span>
											<!-- added class 'logInb1' here, and removed hyperlink href="https://www.flipkart.com/account/login?ret=/" -->
										</button>
										<a class="_2AkmmA _1LctnI jUwFiZ logInb1"><span>Existing
												User? Log in</span></a>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!--second signup page that appears on clicking " continue "-->
					<div id="signUpModal2" class="_32LSmx" style="display: none;">
						<div class="_1XBjg- wor">
							<div class="Og_iib loc loc-2-5">
								<span class="_1hgiYz"><span>Register</span></span>
								<p class="_1NJjZd">
									<span>We do not share your personal details with anyone.</span>
								</p>
							</div>
							<div class="Km0IJL loc loc-3-5">
								<div>
									<form id="signup2">



										<!-- belongs to utkarsh-->
										<div>
											<span>Enter Name</span>
											<div class="_39M2dM">
												<input type="text" autocomplete="off" class="_2zrpKA"
													id="name1"> <span class="s-YM1W"></span> <label
													class="b5konl"></label>
											</div>
										</div>
										<!-- added id 'mob2' here -->
										<div class="_39M2dM">
											<input type="email" readonly="" autocomplete="off"
												class="_2zrpKA _2rqcw- _2VUCMV _3v41xv" id="email2">
											<span class="s-YM1W _2rqcw-"></span> <label
												class="b5konl _2rqcw-"><span>Email Id</span></label><span
												class="ZAtlA-" id="amit1"></span>
											<!-- added class 'signUpb1' here, and removed hyperlink 'href="https://www.flipkart.com/#"' -->
											<a class="_21JmK0 _1__46T signUpb1" tabindex="-1"><span>Change?</span></a>
										</div>

										<!-- addded pass here -->
										<div>
											<div class="_39M2dM">
												<input type="password" autocomplete="off" class="_2zrpKA"
													id="pass" placeholder="Set Password"> <span
													class="s-YM1W"></span> <label class="b5konl"> <!--<span>Set Password</span>-->
												</label>
											</div>
										</div>

										<!-- addded dob here -->
										<div>
											<span>Enter Address</span>
											<div class="_39M2dM">
												<input type="text" autocomplete="off" class="_2zrpKA"
													id="addr"> <span class="s-YM1W"></span> <label
													class="b5konl"></label>
											</div>
										</div>

									</form>

									<div class="_1avdGP">
										<button id="registerButton" class="_2AkmmA _1LctnI _7UHT_c">
											<div class="_2VTdOs _1_qmw3">
												<svg class="_2zN0mv" viewBox="25 25 50 50">
													<circle stroke="#fff" class="_1VgS7d" cx="50" cy="50"
														r="20" fill="none" stroke-width="5" stroke-miterlimit="10"></circle>
												</svg>
											</div>
											<span> <!-- UTKARSHUTKARSHUTKARSHUTKARSHUTKARSH -->
												Register
											</span>
											<!-- added class 'logInb1' here -->
											<!-- changed from button to link, similar to that in 'signUpModal1' -->
											<div class="_2VTdOs _1_qmw3">
												<svg class="_2zN0mv" viewBox="25 25 50 50">
													<circle stroke="#fff" class="_1VgS7d" cx="50" cy="50"
														r="20" fill="none" stroke-width="5" stroke-miterlimit="10"></circle>
												</svg>
											</div>
										</button>
										<a class="_2AkmmA _1LctnI jUwFiZ logInb1"> <span>
												Existing User? Log in </span>
										</a>
									</div>


								</div>
							</div>
						</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="zi6sUf" id="beforelogin">
		<div class="_3zdbog _3Ed3Ub">
			<ul class="_114Zhd">
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8">Home</span>
				</li>
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8"></span>
				</li>
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8">
						<a href="addbook.html"></a>
				</span></li>
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8">
				</span></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
			</ul>
		</div>
	</div>




	<div class="zi6sUf" id="afterlogin">
		<div class="_3zdbog _3Ed3Ub">
			<ul class="_114Zhd">
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8">Home</span>
				</li>
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8">
						<a href="mybooks.html">My Books</a>
				</span></li>
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8">
						<a href="requested.html">Book Requests</a>
				</span></li>
				<li class="Wbt_B2 _1YVU3_"><span class="_1QZ6fC _3Lgyp8"><a
						href="myrequested.html">Book Requested By Me</a></span></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
				<li class="Wbt_B2 _1YVU3_"></li>
			</ul>
		</div>
	</div>
	<div>
		<div class='container'>
			<div class='row single-product'>
				<div class="col-md-12">
					<div class="detail-block">
						<div class="row  wow fadeInUp">

							<div class="col-xs-3 col-sm-2 col-md-3 gallery-holder">
								<div id="gallery"
									class="product-item-holder size-big single-product-gallery small-gallery round3">
								</div>
								<!-- /.single-product-gallery -->
								<hr>
								<div class="beforerequest" align:"center">
									<form>
										<table>
											<tr>
												<td width="80%">
													&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
													<button id="requestbook" type="button" onclick="requestBook()"
														class="_2AkmmA _2Npkh4 _2kuvG8 _7UHT_c">Request Book</button>
												</td>
											</tr>
										</table>
									</form>
								</div>
								<div id="myDIV" align="center" style="display:none;font: 25px arial, sans-serif;">
                         Sorry , The above book has been taken by lended by someone.
        </div>
								<div class="afterrequest" style="display:none">
									<form>
										<table>
											<tr>
												<table><tr><td width="60%">
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button id="alreadyrequested" onclick="return addToCart()" class="_2AkmmA _2Npkh4 _2kuvG8 _7UHT_c" disabled>You have already requested this Book</button>
										</td><td width="40%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button id="cancelrequest" type="button" onclick="return cancelRequest()" class="_2AkmmA _2Npkh4 _2MWPVK">Cancel Request</button>
											</td></tr>
										</table>
									</form>
								</div>
							</div>
							<!-- /.gallery-holder -->
							<div class='col-sm-6 col-md-7 product-info-block'>
								<div class="product-info" id="product-info">

									<h1 class='name' id='title'></h1>

									<div class="row" style="padding-top: 9px;">
										<div class="col-sm-2" style="padding-right: 0px;">
											<span style="font-size: 14px">&nbsp;&nbsp;Book Id </span>
										</div>
										<div class="col-sm-8" style="padding-left: 0px;">
											<span style="font-size: 14px" id='book_id'></span>
										</div>
										<div class="col-sm-4" style="padding-right: 0px;"></div>
									</div>
									<br /> <b>&nbsp;&nbsp;About Book:&nbsp;&nbsp;</b> <span
										class='description-container m-t-20' style="font-size: 14px"
										id='itemdescription'> </span> <br /> <br /> <b>&nbsp;&nbsp;Book
										Author: &nbsp;&nbsp;</b> <span
										class='description-container m-t-20' style="font-size: 14px"
										id='author'> </span> <br /> <br /> <b>&nbsp;&nbsp;Book
										ISBN: &nbsp;&nbsp;</b> <span class='description-container m-t-20'
										style="font-size: 14px" id='isbn'> </span> <br /> <br /> <b>&nbsp;&nbsp;Book
										Publisher: &nbsp;&nbsp;</b> <span
										class='description-container m-t-20' style="font-size: 14px"
										id='publ'> </span> <br /> <br /> <b>&nbsp;&nbsp;Category:
										&nbsp;&nbsp;</b> <span class='description-container m-t-20'
										style="font-size: 14px" id='cat'> </span>
								</div>
							</div>
						</div>
						<!-- /.row -->
					</div>
					<!-- /.quantity-container -->
				</div>
				<!-- /.product-info -->
			</div>
			<!-- /.col-sm-7 -->
		</div>
		<!-- /.row -->
	</div>








	<!-- /.breadcrumb -->



	<!-- /.row -->



</body>

<script>
	$(document).ready(function() {
		$("p").hide();
		var ownerId=localStorage.getItem("id"); 
	    if (ownerId == "")
	    {
	    	displaybook();
	    }
	    if(ownerId != "")
	    {
	    	console.log("check1 "+ownerId);
	    	displaybook();
	    }
	    userIsRequester();
	    isInTransaction();
	});

	var chck;
	function displaybook() {
		var ctxPath = "http://localhost:" + location.port + "/thebooklender";
		var URL = 'http://localhost:' + location.port
				+ '/thebooklender/item.html';
		var bookId = getURLParameter('bookId', URL);
		var variablePath = "/api/books/" + bookId;
		$
				.ajax({
					type : 'GET',
					contentType : 'application/json',
					url : ctxPath + variablePath,
					dataType : "json",
					success : function(data) {
						chck=data.owner_id;
						$("#book_id").text(" " + data.book_id);
						$("#itemdescription").text(data.description);
						$("#author").text(data.author);
						$("#title").text(data.title);
						$("#cat").text(data.category);
						$("#aval").text(data.available);
						$("#publ").text(data.publisher);
						$("#isbn").text(data.isbn);
						if (data.image != "") {
							var img_data = "<div id='owl-single-product'>"
									+ "    <div class='single-product-gallery-item' id='slide1'>"
									+ "        <a data-lightbox='image-1' data-title='Gallery' href='http://www.51allout.co.uk/wp-content/uploads/2012/02/Image-not-found.gif'>"
									+ "            <img class='img-responsive' alt='' style='display: block; object-fit: contain; width: 480px; height: 300px;' src='"+data.image+"' />"
									+ "        </a>" + "    </div>" + "</div>";
						} else {
							var img_data = "<div id='owl-single-product'>"
									+ "    <div class='single-product-gallery-item' id='slide1'>"
									+ "        <a data-lightbox='image-1' data-title='Gallery' href='https://previews.123rf.com/images/themoderncanvas/themoderncanvas1603/themoderncanvas160300013/53245338-404-page-not-found-error-icon-internet-error-sign-laptop-browser-error-symbol-white-laptop-404-error.jpg'>"
									+ "            <img class='img-responsive' alt='' style='display: block; object-fit: contain; width: 480px; height: 300px;' src='https://previews.123rf.com/images/themoderncanvas/themoderncanvas1603/themoderncanvas160300013/53245338-404-page-not-found-error-icon-internet-error-sign-laptop-browser-error-symbol-white-laptop-404-error.jpg' />"
									+ "        </a>" + "    </div>" + "</div>";
						}
						$("#gallery").html(img_data);
						checkownerbooks();
					}
				});

	}
    
	function getURLParameter(sParam, staticURL) {
		var baseURL = (window.location).href;
		if (baseURL.length == staticURL.length) {
			window.location.href = "/thebooklender/";
			return;
		}
		var sPageURL = window.location.search.substring(1);
		var sURLVariables = sPageURL.split('&');
		for (var i = 0; i < sURLVariables.length; i++) {
			var sParameterName = sURLVariables[i].split('=');
			if (sParameterName[0] == sParam)
				return sParameterName[1];
		}
	}
	
	function checkownerbooks() {
		var ownerId=localStorage.getItem("id"); 
		console.log("check " + ownerId);
		var ctxPath = "http://localhost:" + location.port + "/thebooklender";
		$.ajax({
			type: 'GET',
			contentType : 'application/json',
			url : ctxPath + "/api/books/user/" + ownerId,
			dataType : "json",
			success : function(result) {
				for(var i in result)
			    {
					if(chck == ownerId)
					{
						console.log("check2 " + result[i].owner_id );
						document.getElementById("requestbook" ).style.visibility = "hidden";
						$("p").show();
					}
				}
			}
		});
	}
	
	function requestBook() {
		console.log("1");
		var userdetails = JSON.stringify({
			"user_email" : localStorage.getItem("user_email"),
			"user_name" : localStorage.getItem("user_name"),
			"address" : localStorage.getItem("address"),
		});
		console.log("req " + userdetails);
		var userId=localStorage.getItem("id"); 
		console.log("reqcheck " + userId);
		var URL = 'http://localhost:' + location.port+ '/thebooklender/item.html';
        var bookId = getURLParameter('bookId', URL);
        console.log("che"+bookId);
		var ctxPath = "http://localhost:" + location.port + "/thebooklender";
		$.ajax({
			type: 'POST',
			contentType : 'application/json',
			url : ctxPath + "/api/books/requestbook?id=" + bookId + "&requestedby=" + userId,
			data : userdetails,
			success : function() {
				swal({
					  title: "Request Sent",
					  icon: "success",
					});
				  // alert("You request has been sent successfully");
				//	swal("You request has been sent successfully");
					userIsRequester();
				}
		});
	} 
	
	function userIsRequester() {
		var userId=localStorage.getItem("id"); 
		console.log("reqcheck " + userId);
		var URL = 'http://localhost:' + location.port+ '/thebooklender/item.html';
		var bookId = getURLParameter('bookId', URL);
		var ctxPath = "http://localhost:" + location.port + "/thebooklender";
		$.ajax({
			type: 'GET',
			contentType : 'application/json',
			url : ctxPath + "/api/books/requests/"+bookId,
			success : function(result) {
				console.log(result);
				for(var i in result)
				{
					if(userId==result[i].id)
					{
						$(".afterrequest").show();
						$(".beforerequest").hide();
					}
				}
			}
		});
	} 
	
	function cancelRequest() {
		var userId=localStorage.getItem("id"); 
		console.log("reqcheck " + userId);
		var URL = 'http://localhost:' + location.port+ '/thebooklender/item.html';
		var bookId = getURLParameter('bookId', URL);
		var ctxPath = "http://localhost:" + location.port + "/thebooklender";
		var userdetails = JSON.stringify({
			"user_email" : localStorage.getItem("user_email"),
			"user_name" : localStorage.getItem("user_name"),
			"address" : localStorage.getItem("address"),
		});
		$.ajax({
			type: 'POST',
			contentType : 'application/json',
			url : ctxPath + "/api/books/cancelbook?bookid="+ bookId + "&userid=" + userId,
			data : userdetails,
			success : function(result) {
				swal({
					  title: "Request Cancelled",
					  icon: "success",
					});
				$(".afterrequest").hide();
				$(".beforerequest").show();
			}
		});
	}
	
	

	function isInTransaction() {
		var userId=localStorage.getItem("id"); 
		console.log("reqcheck " + userId);
		var URL = 'http://localhost:' + location.port+ '/thebooklender/item.html';
		var bookId = getURLParameter('bookId', URL);
		var ctxPath = "http://localhost:" + location.port + "/thebooklender";
		$.ajax({
			type: 'GET',
			contentType : 'application/json',
			url : ctxPath + "/api/books/isexistsInTransaction?bookid="+ bookId,
			success : function(result) {
				console.log("isin " + result);
				if(result==1)
					{
					   $("#requestbook").hide();
					   $("#myDIV").show();
					}
				
			}
		});
	}
	
</script>
<script type="text/javascript">
	var selectedId;
	var items = [];
	var suggestionItems = [];
	var ani = [];
	
	$.ajax({
		type : 'GET',
		url : "http://localhost:" + location.port + "/thebooklender/api/books/allbooks",
		dataType : "json",
		async: false,
		success : function(itemList) {
			/*  console.log("gvhgvjhvjhvhjv "+itemList); 
 */			ItemAutoComplete(itemList);
			},
		error : function(err) {
			alert(err.status);
			}
		});
		
	function ItemAutoComplete(itemList){
		 /* console.log("gvhgvjhvjhvhjv "+itemList); */
		var itemSearch = [];
		for(var x in itemList){
			var temp = {};
			temp['id'] = itemList[x].id;
			temp['value'] = itemList[x].title;
			itemSearch.push(temp);
			ani.push(temp);
			items.push(itemList[x].title);
			//console.log("ani print ="+ani[x].value);
 		}
		$( "#search-bar" ).autocomplete({
			  source: itemSearch,
			  response: function(event, ui){
				  suggestionItems = ui.content;
				  console.log("===========================");
				  for(var it in suggestionItems){
					  console.log(suggestionItems[it]);
				  }
			  },
			  select: function(event, ui){
				  suggestionItems = ui.content;
				  console.log("===========================");
				  for(var it in suggestionItems){
					  console.log(suggestionItems[it]);
				  }
			  }
			});
	}
	
	$("#search-button").click(function(){
		console.log("search items ="+ani[0].value);
		var searchVal = $("#search-bar").val();
		console.log(searchVal);
		for (var i in ani){
			if(ani[i].value.includes(searchVal)){
				searchVal=ani[i].id;
			}
		}
		window.location.href = "http://localhost:"+location.port+"/thebooklender/item.html?bookId="+searchVal;
		
		/* if(items.includes(selectedItem)==true)
			window.location.href = "item.jsp?id="+selectedId;
		else
			swal("", "No such item found", "error"); */
	})
	
	</script>

<footer id="footer" class="footer color-bg">
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-6 col-md-3">
                    <div class="module-heading">
                        <h4 class="module-title">Contact Us</h4>
                    </div><!-- /.module-heading -->

                    <div class="module-body">
        <ul class="toggle-footer" style="">
            <li class="media">
                <div class="pull-left">
                     <span class="icon fa-stack fa-lg">
                            <i class="fa fa-map-marker fa-stack-1x fa-inverse"></i>
                    </span>
                </div>
                <div class="media-body">
                    <p>IIITB M-Tech 1st Year Project</p>
                </div>
            </li>
              <li class="media">
                <div class="pull-left">
                     <span class="icon fa-stack fa-lg">
                      <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                    </span>
                </div>
                <div class="media-body">
                    <span><a href="#">thebooklender2019@outlook.com</a></span>
                </div>
            </li>
              
            </ul>
    </div><!-- /.module-body -->
                </div><!-- /.col -->
            </div>
        </div>
    </div>
</footer>

<!-- ============================================================= FOOTER : END============================================================= -->

<!-- JavaScripts placed at the end of the document so the pages load faster -->
</html>